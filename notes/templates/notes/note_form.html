{% extends 'base.html' %}

{% block title %}
{% if form.instance.pk %}Edit Note{% else %}New Note{% endif %} - BlogerMenia
{% endblock %}

{% block extra_head %}
<!-- Quill CSS -->
<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
<style>
    .ql-editor {
        min-height: 300px;
        font-size: 1.125rem;
        font-family: inherit;
        line-height: 1.75;
    }

    .ql-container {
        border-bottom-left-radius: 0.75rem;
        border-bottom-right-radius: 0.75rem;
        background-color: white;
        font-family: inherit;
    }

    .ql-toolbar {
        border-top-left-radius: 0.75rem;
        border-top-right-radius: 0.75rem;
        background-color: #f8fafc;
        border-color: #e2e8f0 !important;
        font-family: inherit;
    }

    .ql-container.ql-snow {
        border-color: #e2e8f0 !important;
    }
</style>
{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8 max-w-4xl">
    <!-- Header -->
    <div class="mb-8">
        <a href="{% url 'my_note_list' %}"
            class="inline-flex items-center text-sm text-gray-500 hover:text-indigo-600 mb-4 transition-colors">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd"
                    d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z"
                    clip-rule="evenodd" />
            </svg>
            Back to My Notes
        </a>
        <h1 class="text-3xl font-bold text-gray-900">
            {% if form.instance.pk %}Edit Note{% else %}Create New Note{% endif %}
        </h1>
    </div>

    <!-- Main Editor -->
    <div class="bg-white rounded-3xl shadow-lg border border-gray-100 overflow-hidden">
        <form method="POST" id="note-form" class="p-6 md:p-8">
            {% csrf_token %}

            <div class="space-y-6 mb-6">
                <!-- Title -->
                <div>
                    <label for="{{ form.title.id_for_label }}"
                        class="block text-sm font-semibold text-gray-700 mb-2">Title</label>
                    {{ form.title }}
                    {% if form.title.errors %}
                    <p class="text-red-500 text-sm mt-1">{{ form.title.errors.0 }}</p>
                    {% endif %}
                </div>

                <!-- Tags -->
                <div>
                    <label for="{{ form.tags.id_for_label }}"
                        class="block text-sm font-semibold text-gray-700 mb-2">Tags</label>
                    {{ form.tags }}
                    {% if form.tags.errors %}
                    <p class="text-red-500 text-sm mt-1">{{ form.tags.errors.0 }}</p>
                    {% endif %}
                </div>

                <!-- Editor Container -->
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Content</label>
                    <div id="editor-container"></div>
                    <input type="hidden" name="content" id="content-hidden">
                    {% if form.content.errors %}
                    <p class="text-red-500 text-sm mt-1">{{ form.content.errors.0 }}</p>
                    {% endif %}
                </div>
            </div>

            <div class="flex items-center justify-end gap-3 pt-6 border-t border-gray-100">
                <a href="{% url 'my_note_list' %}"
                    class="px-6 py-2.5 text-gray-600 font-medium hover:bg-gray-50 rounded-xl transition-colors">
                    Discard
                </a>
                <button type="submit"
                    class="px-6 py-2.5 bg-indigo-600 text-white font-semibold rounded-xl hover:bg-indigo-700 shadow-lg shadow-indigo-200 transition-all hover:-translate-y-0.5">
                    {% if form.instance.pk %}Save Changes{% else %}Publish Note{% endif %}
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Quill JS -->
<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
<script>
    var quill = new Quill('#editor-container', {
        theme: 'snow',
        placeholder: 'Start writing your amazing note...',
        modules: {
            toolbar: [
                [{ 'header': [1, 2, 3, false] }],
                ['bold', 'italic', 'underline', 'strike', 'blockquote'],
                [{ 'list': 'ordered' }, { 'list': 'bullet' }],
                [{ 'color': [] }, { 'background': [] }],
                ['link', 'code-block'],
                ['clean']
            ]
        }
    });

    // Load initial content if editing
    {% if form.instance.pk %}
    quill.root.innerHTML = `{{ form.instance.content|safe }}`;
    {% endif %}

    // Handle Form Submission
    document.querySelector('#note-form').onsubmit = function () {
        var content = document.querySelector('#content-hidden');
        content.value = quill.root.innerHTML;
    };
</script>
{% endblock %}