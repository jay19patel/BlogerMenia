{% extends "base.html" %}


{% block title %}
{% if object %}Edit Playlist - {{ object.name }}{% else %}Create New Playlist{% endif %} - BlogerMenia
{% endblock %}

{% block extra_head %}
<!-- Lucide Icons -->
<script src="https://unpkg.com/lucide@latest"></script>
<style>
    /* Custom Scrollbar */
    .custom-scrollbar::-webkit-scrollbar {
        width: 6px;
    }

    .custom-scrollbar::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 4px;
    }

    .custom-scrollbar::-webkit-scrollbar-thumb {
        background: #c1c1c1;
        border-radius: 4px;
    }

    .custom-scrollbar::-webkit-scrollbar-thumb:hover {
        background: #a8a8a8;
    }
</style>
{% endblock %}

{% block content %}
<div class="py-12">
    <div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="bg-white rounded-2xl shadow-xl overflow-hidden">
            <div class="bg-indigo-600 px-8 py-6">
                <h1 class="text-2xl font-bold text-white">
                    {% if object %}
                    Edit Playlist: {{ object.name }}
                    {% else %}
                    Create New Playlist
                    {% endif %}
                </h1>
                <p class="text-indigo-100 mt-2">Curate your articles into collections.</p>
            </div>

            <div class="p-8">
                <form method="POST" enctype="multipart/form-data">
                    {% csrf_token %}

                    {{ form.media }}

                    <div class="space-y-6">
                        {% for field in form %}
                        <div>
                            <label for="{{ field.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">
                                {{ field.label }}
                                {% if field.field.required %}<span class="text-red-500">*</span>{% endif %}
                            </label>

                            {% if field.name == 'thumbnail' %}
                            <div
                                class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md hover:border-indigo-500 transition-colors">
                                <div class="space-y-1 text-center">
                                    <svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none"
                                        viewBox="0 0 48 48" aria-hidden="true">
                                        <path
                                            d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02"
                                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                    </svg>
                                    <div class="flex text-sm text-gray-600 justify-center">
                                        <label for="{{ field.id_for_label }}"
                                            class="relative cursor-pointer bg-white rounded-md font-medium text-indigo-600 hover:text-indigo-500 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-indigo-500">
                                            <span>Upload a file</span>
                                            {{ field }}
                                        </label>
                                    </div>
                                    <p class="text-xs text-gray-500">PNG, JPG up to 10MB</p>
                                </div>
                            </div>
                            {% elif field.name == 'blogs' %}
                            <label class="block text-sm font-medium text-gray-700 mb-3">
                                Select Blogs for Playlist
                                <span class="text-xs font-normal text-gray-500 ml-1">(Selected: <span
                                        id="selectedCount">0</span>)</span>
                            </label>

                            <div class="space-y-3 max-h-[500px] overflow-y-auto pr-2 custom-scrollbar p-1">
                                {% for blog in user_blogs %}
                                <label
                                    class="relative flex items-center p-4 border rounded-xl cursor-pointer transition-all duration-200 hover:shadow-md group bg-white border-gray-200 has-[:checked]:border-indigo-600 has-[:checked]:bg-indigo-50 has-[:checked]:ring-1 has-[:checked]:ring-indigo-600">
                                    <input type="checkbox" name="blogs" value="{{ blog.id }}"
                                        class="peer sr-only blog-checkbox" {% if blog.id in selected_blog_ids%} checked
                                        {% endif %} onchange="updateSelectedCount()">

                                    <!-- Checkbox UI -->
                                    <div class="flex-shrink-0 mr-4">
                                        <div
                                            class="w-6 h-6 rounded-full border-2 border-gray-300 peer-checked:border-indigo-600 peer-checked:bg-indigo-600 flex items-center justify-center transition-colors">
                                            <i data-lucide="check"
                                                class="w-3.5 h-3.5 text-white opacity-0 peer-checked:opacity-100 transition-opacity font-bold"></i>
                                        </div>
                                    </div>

                                    <!-- Content -->
                                    <div class="flex items-center gap-4 flex-1 min-w-0">
                                        {% if blog.thumbnail %}
                                        <img src="{{ blog.thumbnail.url }}" alt="{{ blog.title }}"
                                            class="w-16 h-16 rounded-lg object-cover flex-shrink-0 bg-gray-100">
                                        {% else %}
                                        <div
                                            class="w-16 h-16 rounded-lg bg-gray-100 flex items-center justify-center flex-shrink-0 text-gray-400">
                                            <i data-lucide="image" class="w-6 h-6"></i>
                                        </div>
                                        {% endif %}

                                        <div class="flex-1 min-w-0">
                                            <h3 class="text-sm font-semibold text-gray-900 truncate pr-4">
                                                {{ blog.title }}</h3>
                                            <div class="flex items-center text-xs text-gray-500 mt-1 gap-2">
                                                <span>{{ blog.created_at|date:"M d, Y" }}</span>
                                                <span class="w-1 h-1 rounded-full bg-gray-300"></span>
                                                <span class="truncate">{{ blog.views|default:"0" }} views</span>
                                            </div>
                                        </div>

                                        <!-- View Icon (Hover) -->
                                        <div class="opacity-0 group-hover:opacity-100 transition-opacity px-2">
                                            <a href="{% url 'blog-detail' blog.author.username blog.slug %}"
                                                target="_blank" class="text-gray-400 hover:text-indigo-600 p-1 block"
                                                title="View Blog">
                                                <i data-lucide="external-link" class="w-4 h-4"></i>
                                            </a>
                                        </div>
                                    </div>
                                </label>
                                {% empty %}
                                <div class="text-center py-10 border-2 border-dashed border-gray-200 rounded-xl">
                                    <div
                                        class="mx-auto w-12 h-12 bg-gray-50 rounded-full flex items-center justify-center text-gray-400 mb-3">
                                        <i data-lucide="file-x" class="w-6 h-6"></i>
                                    </div>
                                    <h3 class="text-sm font-medium text-gray-900">No blogs found</h3>
                                    <p class="text-sm text-gray-500 mt-1">You haven't published any blogs yet.</p>
                                    <a href="{% url 'blog_create' %}"
                                        class="mt-3 inline-flex items-center text-sm font-medium text-indigo-600 hover:text-indigo-700">
                                        Create your first blog
                                        <i data-lucide="arrow-right" class="w-4 h-4 ml-1"></i>
                                    </a>
                                </div>
                                {% endfor %}
                            </div>
                            <div class="mt-1 flex justify-between items-center px-1">
                                <p class="text-xs text-gray-500">Select the blogs you want to see in this playlist.</p>
                                <button type="button"
                                    onclick="document.querySelectorAll('.blog-checkbox').forEach(c => c.checked=false); updateSelectedCount();"
                                    class="text-xs text-red-500 hover:text-red-700 font-medium">Clear Selection</button>
                            </div>

                            <script>
                                function updateSelectedCount() {
                                    const count = document.querySelectorAll('.blog-checkbox:checked').length;
                                    document.getElementById('selectedCount').innerText = count;
                                }
                                document.addEventListener('DOMContentLoaded', () => {
                                    if (typeof lucide !== 'undefined') {
                                        lucide.createIcons();
                                    }
                                    updateSelectedCount();
                                });
                            </script>
                            {% elif field.name == 'is_public' %}
                            <div class="flex items-center">
                                {{ field }}
                                <label for="{{ field.id_for_label }}" class="ml-2 block text-sm text-gray-900">
                                    {{ field.label }}
                                </label>
                            </div>
                            {% else %}
                            <div class="mt-1">
                                {{ field }}
                            </div>
                            {% endif %}

                            {% if field.help_text %}
                            <p class="mt-2 text-sm text-gray-500">{{ field.help_text }}</p>
                            {% endif %}

                            {% if field.errors %}
                            <p class="mt-2 text-sm text-red-600">{{ field.errors.0 }}</p>
                            {% endif %}
                        </div>
                        {% endfor %}
                    </div>

                    <div class="mt-8 flex items-center justify-end gap-4">
                        <a href="{% url 'user-blogs' user.username %}"
                            class="px-6 py-2.5 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition-colors">
                            Cancel
                        </a>
                        <button type="submit"
                            class="px-6 py-2.5 bg-indigo-600 text-white rounded-lg font-medium hover:bg-indigo-700 transition-colors shadow-lg shadow-indigo-500/30">
                            {% if object %}Update Playlist{% else %}Create Playlist{% endif %}
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}